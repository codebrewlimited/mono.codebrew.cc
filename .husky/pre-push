#!/bin/sh
echo "üîç Checking changes in workspaces..."

PUSH_NEEDED=0

# -----------------
# v1
# -----------------
if git diff --name-only origin/main | grep -q "^v1/"; then
  echo "‚¨ÜÔ∏è Running version bump for v1..."
  cd v1
  npx standard-version --no-verify
  cd ..
  PUSH_NEEDED=1
fi

# -----------------
# v2
# -----------------
if git diff --name-only origin/main | grep -q "^v2/"; then
  echo "‚¨ÜÔ∏è Running version bump for v2..."
  cd v2
  npx standard-version --no-verify
  cd ..
  PUSH_NEEDED=1
fi

# -----------------
# Push commits and tags if any version bump occurred
# -----------------
if [ $PUSH_NEEDED -eq 1 ]; then
  echo "üöÄ Pushing bumped versions and tags..."
  git push origin main --follow-tags --no-verify
else
  echo "‚úÖ No version bump needed, proceeding with push."
fi
